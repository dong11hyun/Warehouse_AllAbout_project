
- Race Condition 분석 
- 비관적 락의 원리와 한계
- redis 기반 동시성 제아
- kubernetes 스케일링 전략
- 이상 탐지 파이프라인 아키텍쳐
- celery 재시도와 부분 실패
- 긴 트랜잭션의 문제점
- 멱등성과 이벤트 소싱
- 잔액 조회 방식 비교
- 분석 쿼리와 운영 db 분리
- django channel과 channel layers
- 알림 중복의 원인과 결과
- nginx websocket 설정
- 알림 피로도 관리
- 알림 발송 결정 로직
- celery eta한계
- sweep 잡의 문제점 과 해결
- 부분실패와 상태머신
- celery 워커 설정
- celery 태스크 취소의 한계
---

- 당신은 실시간 경매 플랫폼의 백엔드 개발자입니다. Django + Redis + MySQL 스택을 사용하며, 
입찰 요청은 초당 수백 건이 들어옵니다. 
- 인기 경매에는 마감 직전 "스나이핑" 현상으로 순간적으로 
초당 수천 건의 입찰이 몰리기도 합니다. 
어느 날, 고객 클레임이 접수되었습니다. "분명히 150만원을 입찰했는데, 낙찰자가 120만원으로 
결정됐어요. 제 입찰은 어디로 간 거죠?" 
- 로그를 확인해보니, 해당 고객의 입찰 요청은 성공 응답(200 
OK)을 받았지만, 최종 입찰 기록에는 반영되지 않았습니다. 
개발팀이 작성한 입찰 처리 코드는 다음과 같았습니다:
--- 

- 재화 시스템의 정합성 악몽 
당신은 경매 플랫폼의 재화(앱 내 화폐) 시스템을 담당하고 있습니다. 사용자는 현금을 충전하여 
재화를 얻고, 이 재화로 입찰합니다. 낙찰되면 재화가 판매자에게 이전되고, 낙찰 실패 시 잠금이 
해제됩니다. 
- 어느 날 재무팀에서 연락이 왔습니다. "시스템 전체 재화 총량이 맞지 않아요. 어제 충전된 총액은 
1 억인데, 현재 전체 사용자 잔액 합계가 1억 2천만이에요." 조사 결과, 특정 경매에서 낙찰 실패자 
환불이 중복 처리된 것으로 추정됩니다. 

--- 

- WebSocket과 알림의 복잡한 춤 
당신은 경매 플랫폼의 실시간 알림 시스템을 담당하고 있습니다. 사용자는 경매 페이지에 접속하면 
WebSocket 으로 연결되어 입찰 현황을 실시간으로 받습니다. 또한 "상위 입찰 발생", "경매 마감 
임박" 등의 푸시 알림도 발송됩니다. 
- 문제가 발생했습니다. 일부 사용자가 "입찰했는데 화면에 반영이 안 된다"고 불만을 제기했고, 다른 
사용자들은 "같은 알림이 3번씩 온다"고 불만을 제기했습니다. 서버 로그를 보니 Uvicorn 인스턴스가 
4 개로 스케일아웃되어 있었고, WebSocket 연결이 인스턴스별로 분산되어 있었습니다. 
현재 구조는 다음과 같습니다

--- 

경매 종료의 신뢰성 문제 
당신은 경매 플랫폼의 "경매 생명주기 관리" 시스템을 담당하고 있습니다. 경매가 종료되면 낙찰자를 
결정하고, 재화를 이전하고, 알림을 발송해야 합니다. Celery Beat로 경매 종료 시간에 맞춰 태스크를 
예약하고 있습니다. 
어느 날 심각한 문제가 발생했습니다. Redis(Celery 브로커)가 10분간 장애를 겪었고, 그 사이에 종료 
예정이던 50개의 경매가 처리되지 않았습니다. 경매 페이지에는 "마감"이라고 표시되었지만, 
낙찰자도 결정되지 않았고 재화 이전도 이루어지지 않았습니다. 

 
