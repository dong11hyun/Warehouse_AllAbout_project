#  Musinsa Search Engine (무신사 데이터 검색 엔진)

> **프로젝트 개요** > 무신사(Musinsa)의 상품 데이터를 **비동기 크롤링(Async Crawling)**으로 수집하여 **OpenSearch(검색 엔진)**에 적재하고, **FastAPI**를 통해 검색 서비스를 제공하는 End-to-End 데이터 파이프라인 프로젝트입니다.

##  Architecture (아키텍처)

단순한 데이터 수집을 넘어, 실제 서비스 가능한 형태의 **검색 시스템(Search System)**을 구축하였습니다.

```mermaid
flowchart LR
    A[무신사 웹사이트] -->|비동기 수집 (Playwright)| B(데이터 전처리 Worker)
    B -->|Bulk Insert| C[(OpenSearch + Nori)]
    C <-->|Search Query| D[FastAPI Server] >>  `http://127.0.0.1:8000/docs`
    D <-->|REST API| E[Web Frontend]
```
- 즉, 사용자가 보게 될 화면은  
**OpenSearch에 '저장'** 된 것을 **FastAPI로 '전달'** 해서 **HTML로 '보여진다'** 

1. **Data Collection**: `Playwright`를 사용하여 동적 웹페이지(Dynamic DOM)의 렌더링 문제를 해결하고 데이터 수집.
2. **Indexing**: `OpenSearch`와 `Nori(한국어 형태소 분석기)`를 활용해 검색 최적화된 인덱스 설계.
3. **Backend API**: `FastAPI`와 `Pydantic`을 사용하여 데이터 검증 및 고속 검색 API 구현.
4. **Frontend**: 사용자가 실제 검색을 경험할 수 있는 웹 UI 구현.

---

## 🛠️ Tech Stack (기술 스택)

| 분류 | 기술 | 선정 이유 |
| --- | --- | --- |
| **Language** | Python 3.10+ | 데이터 처리 및 비동기 프로그래밍에 최적화 |
| **Crawler** | Playwright (Async) | Selenium 대비 빠른 속도 및 동적 페이지(Next.js 등) 완벽 대응 |
| **Search Engine** | OpenSearch 2.11 | 대용량 데이터의 역색인(Inverted Index) 처리 및 전문 검색(Full-text Search) 지원 |
| **Analyzer** | Analysis-Nori | 한글 복합명사 분리 및 검색 정확도 향상 플러그인 |
| **Backend** | FastAPI | Pydantic을 통한 강력한 타입 검증 및 비동기 서버 성능 |
| **Infra** | Docker & Compose | 복잡한 검색 엔진 환경의 컨테이너화 및 배포 용이성 |

---

## 🔥 Troubleshooting & Problem Solving (문제 해결 과정)

프로젝트 개발 과정에서 직면한 주요 기술적 이슈와 해결 방법입니다.

### 1. 동적 클래스명(Random Class Name)으로 인한 수집 실패

* **문제**: 무신사 페이지의 CSS 클래스명이 `sc-m8pxwf-2`와 같이 랜덤 생성되어, 배포 시마다 선택자(Selector)가 무효화됨.
* **해결**:
* **Meta Tag 활용**: 변하지 않는 `og:title`, `product:price:amount` 메타 태그를 우선적으로 수집하여 안정성 확보.
* **XPath Relative Locator**: 클래스명 대신 화면에 보이는 텍스트("상호 / 대표자")를 기준으로 인접한 태그(`following-sibling`)를 찾는 상대 위치 전략 적용.



### 2. Playwright Strict Mode Violation (중복 요소 에러)

* **문제**: `page.locator(...)` 실행 시 페이지 내에 동일한 속성을 가진 태그가 2개 이상 존재하여 `resolved to 2 elements` 에러 발생 및 프로세스 중단.
* **해결**: `.first` 메서드를 체이닝하여 중복된 요소 중 첫 번째 요소를 명시적으로 선택하도록 로직 개선 (`Strict Mode` 준수).

### 3. 데이터 정합성 불일치로 인한 API 500 에러

* **문제**: 크롤러에서는 `brand`, `price` 필드를 누락한 채 저장했으나, FastAPI의 `Pydantic` 모델은 해당 필드를 필수값으로 정의하여 `Internal Server Error` 발생.
* **해결**:
* OpenSearch의 `Index Mapping`과 Pydantic의 `Schema`를 일치시킴.
* 크롤러 단계에서 데이터 누락 시 기본값(`Default Value`)을 할당하도록 예외 처리 로직 추가.



---

## 📂 Directory Structure (폴더 구조)

```bash
├── docker-compose.yml       # OpenSearch & Dashboards 컨테이너 설정
├── init_opensearch.py       # 인덱스 생성, Mapping 정의, Nori 분석기 설정
├── v3.0_musinsa_loader.py   # [ETL] 메인 크롤러 & 데이터 적재 스크립트
├── api_server.py            # [Backend] 검색 REST API 서버
├── index.html               # [Frontend] 검색 데모 웹페이지
└── README.md                # 프로젝트 문서

```

---

## 🚀 How to Run (실행 방법)

### 1. 검색 엔진 환경 구성 (Docker)

```bash
# OpenSearch 컨테이너 실행
docker-compose up -d

# (최초 1회) 한국어 형태소 분석기 설치 및 재시작
docker exec -it opensearch-node ./bin/opensearch-plugin install analysis-nori
docker-compose restart

```

### 2. 인덱스 초기화 및 매핑

```bash
# 기존 인덱스 삭제 후 Nori 분석기가 적용된 새 인덱스 생성
python init_opensearch.py

```

### 3. 데이터 수집 및 적재 (ETL)

```bash
# 무신사 데이터 크롤링 후 OpenSearch에 Bulk Insert
python v3.0_musinsa_loader.py

`http://localhost:5601/` openSearch Dashboards 접속
```

### 4. 검색 서버 실행

```bash
# FastAPI 서버 가동 (http://localhost:8000)
`python api_server.py` 터미널 실행

```

### 5. 서비스 접속

* **Web UI**: **`index.html` 파일을 브라우저로 실행하여 상품 검색.**
* **API Docs**: `http://localhost:8000/docs` 에서 Swagger UI 확인.

---

## 🔮 Future Improvements (향후 개선 사항)

* **대시보드 구축**: OpenSearch Dashboards를 활용하여 브랜드별 상품 수, 가격대별 분포 시각화.
* **Airflow 도입**: 매일 특정 시간에 자동으로 신상품을 수집하는 스케줄링 파이프라인 구축.
* **고급 검색**: 오타 교정(Fuzzy Search) 및 동의어 사전(Synonym) 추가를 통한 검색 품질 고도화.